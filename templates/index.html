<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3ヶ国語 投稿支援ツール</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #f4f7f9; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .container { max-width: 650px; width: 100%; background: #ffffff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #333; text-align: center; margin-bottom: 20px; font-size: 1.8em; }
        p.info { text-align: center; color: #555; margin-bottom: 20px; }

        /* 入力フォームエリア */
        textarea#input_text { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; resize: vertical; min-height: 100px; font-size: 1em; }
        .button-group { display: flex; gap: 10px; margin-bottom: 30px; }
        .button-group button { flex-grow: 1; background-color: #33a8ff; color: white; padding: 12px 15px; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: background-color 0.3s; }
        .button-group button:hover { background-color: #007bff; }

        /* 結果表示エリア */
        .result-box { border-top: 2px solid #eee; padding-top: 20px; }
        h2 { font-size: 1.3em; color: #007bff; margin-bottom: 15px; }
        textarea#output_text { width: 100%; padding: 15px; border: 2px dashed #007bff; border-radius: 8px; box-sizing: border-box; resize: none; min-height: 150px; background-color: #e6f7ff; font-size: 1.05em; line-height: 1.5; color: #333; cursor: pointer; }
        #copy-button { background-color: #28a745; margin-top: 10px; padding: 10px; }
        #copy-button:hover { background-color: #1e7e34; }
        .error { color: #d32f2f; background-color: #ffcdd2; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>📲 3ヶ国語 投稿支援ツール</h1>
        <p class="info">日本語、中国語、ベトナム語のいずれかで入力すると、残りの2言語に自動で翻訳し、コピーしやすい形で併記します。</p>

        {% if error %}
            <div class="error">{{ error }}</div>
        {% endif %}

        <form method="POST">
            <label for="input_text" style="font-weight: bold; display: block; margin-bottom: 5px;">メッセージ入力:</label>
            <textarea name="input_text" id="input_text" placeholder="例: 明日の朝10時に会議室でお会いしましょう。" required>{{ original_text or '' }}</textarea>
            <div class="button-group">
                <button type="submit">翻訳・コピー用テキスト作成</button>
            </div>
        </form>

        {% if full_output %}
        <div class="result-box">
            <h2>✨ 翻訳結果 (クリックしてコピー)</h2>
            <p style="font-size: 0.9em; color: #777;">入力言語: {{ all_langs[detected_lang_code] }}</p>

            <textarea id="output_text" readonly onclick="copyText()">{{ full_output }}</textarea>
            <div style="margin-top: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
        <label>翻訳するターゲット言語を選択してください (複数選択可):</label>
        <div style="margin-top: 5px;">
        {% for code, label in all_langs.items() %}
            {% if code != 'ja' %} <input type="checkbox" id="lang_{{ code }}" name="target_langs" value="{{ code }}" checked>
            <label for="lang_{{ code }}">{{ label }}</label>
            {% endif %}
        {% endfor %}
        </div>
    </div>

    <button type="submit" style="margin-top: 15px;">翻訳・コピー用テキスト作成</button>
</form>

            <button type="button" id="copy-button" onclick="copyText()">このテキストをコピーする</button>

            <script>
                function copyText() {
                    const outputArea = document.getElementById('output_text');
                    outputArea.select(); // テキストエリアのテキストを選択
                    outputArea.setSelectionRange(0, 99999); // モバイル対応
                    navigator.clipboard.writeText(outputArea.value)
                        .then(() => {
                            // コピー成功時のフィードバック
                            const originalText = document.getElementById('copy-button').textContent;
                            document.getElementById('copy-button').textContent = '✅ コピーしました！';
                            setTimeout(() => {
                                document.getElementById('copy-button').textContent = originalText;
                            }, 1500);
                        })
                        .catch(err => {
                            alert('コピーに失敗しました。手動でテキストを選択してコピーしてください。');
                            console.error('コピーエラー:', err);
                        });
                }
            </script>
        </div>
        {% endif %}
    </div>
</body>
</html>